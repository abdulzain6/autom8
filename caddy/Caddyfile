lk.getautom8.app {
    # Add CORS headers for WebRTC. This handles OPTIONS preflight automatically.
    @options method OPTIONS
    respond @options 204
    header {
        Access-Control-Allow-Origin *
        Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Access-Control-Allow-Headers *
        -Server
    }

    reverse_proxy livekit:7880 {
        header_up Host {host}
        header_up X-Forwarded-For {remote_host}
    }
}

# Main API endpoints
getautom8.app, api.getautom8.app {
    # Log to stdout/stderr in JSON format so 'docker-compose logs' can capture it
    log {
        output stderr
        format json
    }

    # Main reverse proxy to your application server
    reverse_proxy server:8000 {
        # Active health checks
        health_uri /v1/health
        health_interval 10s
        health_timeout 5s
        
        # Headers for proper forwarding
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
    }
}

grafana.getautom8.app {
    reverse_proxy grafana:3000
}


netdata.getautom8.app {
    basicauth {
        abdulzain6 $2a$14$fB76yjUabN4orjI.B1WAeOAIM5c1iyuH2p3ypXicbCu3FOV76G/EG
    }
    reverse_proxy netdata:19999
}

skyvern.autom8.app {
    basic_auth {
        abdulzain6 $2a$14$fB76yjUabN4orjI.B1WAeOAIM5c1iyuH2p3ypXicbCu3FOV76G/EG
    }

    # Reverse proxy to the skyvern-ui service container on port 8080
    reverse_proxy skyvern-ui:8080 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
    }
}